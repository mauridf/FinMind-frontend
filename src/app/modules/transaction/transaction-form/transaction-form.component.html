<div class="transaction-form-container">
  <h2 mat-dialog-title>
    <mat-icon>{{ isEdit ? 'edit' : 'add' }}</mat-icon>
    {{ isEdit ? 'Editar Transação' : 'Nova Transação' }}
  </h2>

  <mat-dialog-content>
    <form [formGroup]="transactionForm" class="transaction-form">
      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Tipo</mat-label>
          <mat-select formControlName="type">
            <mat-option *ngFor="let type of transactionTypes" [value]="type.value">
              <mat-icon>{{ type.icon }}</mat-icon>
              {{ type.label }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="transactionForm.get('type')?.hasError('required')">
            Tipo é obrigatório
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Valor</mat-label>
          <input 
            matInput 
            type="number" 
            formControlName="amount" 
            min="0.01" 
            step="0.01">
          <span matPrefix>R$&nbsp;</span>
          <mat-error *ngIf="transactionForm.get('amount')?.hasError('required')">
            Valor é obrigatório
          </mat-error>
          <mat-error *ngIf="transactionForm.get('amount')?.hasError('min')">
            Valor deve ser maior que zero
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Descrição</mat-label>
          <input matInput formControlName="description" maxlength="100">
          <mat-hint align="end">{{ transactionForm.get('description')?.value?.length || 0 }}/100</mat-hint>
          <mat-error *ngIf="transactionForm.get('description')?.hasError('required')">
            Descrição é obrigatória
          </mat-error>
          <mat-error *ngIf="transactionForm.get('description')?.hasError('minlength')">
            Descrição deve ter pelo menos 3 caracteres
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Categoria</mat-label>
          <mat-select formControlName="category">
            <mat-option *ngFor="let category of categories" [value]="category">
              {{ category }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="transactionForm.get('category')?.hasError('required')">
            Categoria é obrigatória
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Subcategoria</mat-label>
          <input matInput formControlName="subcategory">
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Método de Pagamento</mat-label>
          <mat-select formControlName="paymentMethod">
            <mat-option *ngFor="let method of paymentMethods" [value]="method">
              {{ method }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="transactionForm.get('paymentMethod')?.hasError('required')">
            Método de pagamento é obrigatório
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Data</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="date">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
          <mat-error *ngIf="transactionForm.get('date')?.hasError('required')">
            Data é obrigatória
          </mat-error>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-checkbox formControlName="isRecurring" class="full-width">
          Transação Recorrente
        </mat-checkbox>
      </div>

      <div class="form-row" *ngIf="transactionForm.get('isRecurring')?.value">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Frequência</mat-label>
          <mat-select formControlName="recurringFrequency">
            <mat-option value="1">Semanal</mat-option>
            <mat-option value="2">Mensal</mat-option>
            <mat-option value="3">Anual</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()" [disabled]="loading">
      Cancelar
    </button>
    <button 
      mat-raised-button 
      color="primary" 
      (click)="onSubmit()"
      [disabled]="transactionForm.invalid || loading">
      <mat-spinner diameter="20" *ngIf="loading"></mat-spinner>
      <span *ngIf="!loading">{{ isEdit ? 'Atualizar' : 'Criar' }}</span>
    </button>
  </mat-dialog-actions>
</div>